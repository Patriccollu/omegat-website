<div class="container">

<h2>OmegaT 技術情報：<br/>Word 2007（Office Open XML、.docx）ファイルを OmegaT で翻訳</h2>

<p>この技術情報では、MS Office 2007（以降の版）のファイルを OmegaT で翻訳するためのヒントを提供します。</p>

<h3>背景</h3>

<p>Microsoft Office 2007 の登場により、Microsoft Word、Excel、Powerpoint は、デフォルトのファイル形式が新しくなりました。これは「Office Open XML」と呼ばれる形式であり、それぞれ .docx、.xlsx、.pptx という拡張子を持ちます。この形式は MS Office 2010 でも使われています。便宜上、これを「MS Office 2007 ファイル形式」と呼ぶことにします。</p>

<p>OmegaT はバージョン 1.7.1 以降、Microsoft Office 2007 ファイルを変換なしに直接扱えるようになりました。OmegaT 2.1.8 では、このファイル形式の取り扱いがさらに便利になりました。</p>

<h3>OmegaT で .docx 形式を使用する利点</h3>

<p>顧客/作成者が新版の Microsoft Office/Word の導入を進めるにつれ、翻訳者は新形式のファイルを受け取る機会が増えると予想されます。旧来の形式である .doc、.xls、.ppt とは異なり、新形式のファイルは、他の形式との間の変換で書式情報を失うことなく、OmegaT で直接取り扱うことができます。</p>

<p>また新形式は、旧形式の .doc、.xls、.ppt を取り扱う有効な方法をも提供します。なぜならば、旧形式を MS Office 2007 形式に変換し、OmegaT で翻訳してから、再度変換して旧形式に戻せばいいからです。この手順によって翻訳者は、Apache OpenOffice を使わずに済ませることができます。</p>

<h3>MS Office 2007 形式への変換</h3>

<p>MS Office 1997/2000/2003/XP ファイルを MS Office 2007 で開き、「名前を付けて保存」で新形式を選んで保存することによって、MS Office 2007 形式のファイルに変換することができます。（新形式は今では標準形式なので、MS Office 2007 では単に Word、Excel、Powerpoint のように表示されます。）</p>

<p>MS Office 2007 または 2010 を持っておらず、また購入する意思もないユーザーのために、Microsoft は旧版向けに <a href="http://www.microsoft.com/downloads/details.aspx?familyid=941b3470-3ae9-4aee-8f43-c6bb74cd1466&amp;display">互換性プラグイン</a> を提供しています。</p>

<p>Linux ユーザー：MS Office 2007 と Microsoft 互換性プラグインはいずれも、<a href="http://www.codeweavers.com">Crossover Linux</a> 上で実行できます。</p>

<h3>OmegaT で .docx、.xlsx、.pptx 形式を使用する場合の留意点</h3>

<p>2.1.8 より前の版の OmegaT では、MS Office 2007 ファイル内で書式情報が変わるたびに長く連なったタグが生じ、このファイル形式を取り扱うことが実際的ではありませんでした。バージョン 2.1.8 では、デフォルトで、この連続タグが単一タグに統合・圧縮されるようになりました。したがって、MS Office 2007 ファイルを翻訳する場合は、OmegaT をバージョン 2.1.8 以降にアップグレードするべきです。</p>

<p>（.docx ファイルの取り扱いが容易になった代償として、書式の制御が若干制限されます。たとえば、原文中のある単語が太字かつイタリックになっている場合に、「タグ統合」機能がない状況であれば、翻訳者はこの単語を太字のみまたはイタリックのみにすることができます。「タグ統合」機能が働いていると、そのような選択はできません。ほとんどのユーザーにとっては、この欠点よりも、使いやすさの向上のほうがずっと大きいでしょう。)</p>

<p>.docx 形式もまた、「やっかいな」書式コードを導入した影響を受けやすいため、OmegaT の編集ウィンドウにわずらわしい無用なタグが表示されます。このようなタグは翻訳時に邪魔になるので、OmegaT で翻訳を開始する前にタグを除去することには意義があります。.docx 形式を取り扱う他の CAT ツールも OmegaT と同様の問題に直面しており、解決策も類似しているか同じです。</p>

<h3>.docx ファイルから無用な書式コードを除去する方法</h3>

<ul>


<li><p>Word 2007 は、綴り確認用辞書に含まれていない単語があれば、タグで印をつけます。そのため、綴り間違いと判断された単語が少しあるだけで、過剰なタグが生じます。OmegaT 内ですべての単語がタグで挟まれている場合、適切な綴り確認用辞書がない状態で Word がテキストの綴り確認をしようとしたために、各単語が綴り間違いとしてマークされた可能性があります。1 つの解決策は、Word の自動スペルチェック機能を無効にしておくことです。</p></li>
<li><p>自動ハイフネーションも不要なタグをもたらすので無効にします。文書ごとにこの操作が必要かもしれません。Word 2007 の手順としては、「 ページレイアウト」タブをクリックし、「ページ設定」グループの中で「ハイフネーション」をクリックし、「なし」を選びます。</p></li>

<li><p>検索・置換機能を使って、ダブルスペースを取り除きます（シングルスペースに置換）。</p></li>

<li>テキストにアジア言語文字と「通常」文字（ラテン語など）が混在している場合は、Ctrl+A でテキスト全体を選択してから、単一のフォントを指定します。留意点として、MS 明朝のようにアジア言語文字と「通常」文字をともに含んでいるフォントを選び、[text body] スタイル接尾辞はなしにします。</li>

<li><p>Word 2007 は、自動改ページも含めた改ページにタグを挿入します。このタグは除去できないようです。</p></li>

</ul>

<p>「やっかいな」コードを挿入しないように Word の設定を変更した後でも、たとえば自動ハイフネーションのためにそのようなコードがまだファイル内に存在し、設定の変更では除去されないかもしれません。このようなコードの除去について以下に記します。ただし、やっかいなコードを除去する以下の手順に従う前に、まず Word の設定を変更することを忘れないでください。そうでないと、次にファイルを開いた際に、Word が再びやっかいなコードを挿入してしまうかもしれません。</p>

<h3>CodeZapper マクロ</h3>前述のように、MS Office 2007 に関するこうした問題に直面しているのは、OmegaT だけではありません。翻訳者の <a href="http://asap-traduction.com/CodeZapper">David Turner</a> は、この問題に対処するための MS Word マクロを書きました（強く推奨します）。<h3>文字書式の均一化</h3>

<p>テキストに対して CodeZapper マクロを実行する代わりに、書式を「均一化」するという方法があります。書式の「均一化」とは、選択したテキスト（たとえば 1 段落全体）の先頭文字の書式を、後続のすべての文字に適用することです。なお、これは書式の「削除」とは異なります。削除した場合は、文字書式は文書のデフォルト設定に戻ります。</p>

<p>基本的には、MS Word の全段落をコピーし、段落全体が最初の文字の書式に従うように元の位置にペーストすることによって、段落の書式を均一化することができます。</p>

<h3>段落の文字書式を手動で均一化する</h3>

<p>ステップ 1：段落記号を表示します。段落全体が選択されるまで各段落を繰り返しクリックして、マークを付けます。そこで、選択領域の末尾から 1 文字左へ移動し、段落記号を選択領域から外します。</p>

<p>ステップ 2：選択されたテキストをコピーします（Ctrl+C）ここで、「形式を選択して貼り付け」（Word 2003）を選択するか、または「貼り付け」ボタンの最下部の矢印をクリックして（Word 2007）「形式を選択して貼り付け」を選びます。最後に、「Unicode テキスト」を選んで内容を貼り付けます。</p>

<p>段落がインライン書式（太字、斜字、ハイパーリンクなど）を含まない場合、次のいずれかを行うことができます。</p>

<p>- マクロを使用して上で説明したように段落の書式を均一化してから、書式を追加します。</p>

<p>- 書式設定された部分の前までのテキストのみをマークし、そのテキストをコピーして元の位置に貼り付けます。書式設定された部分より後のテキストについて、同じ操作を繰り返します。</p>

<h3>段落の文字書式を均一化するマクロの作成</h3>

<p>マクロを作成することによって、上述の手順をあるていど自動化できます。マクロの作成（MS Office 2007向け）について以下に簡単に説明します。（詳しい説明については、関連の取扱説明書を参照するか、あるいは<a href="http://office.microsoft.com/en-us/word-help/record-or-run-a-macro-HA010099769.aspx">ここ</a>、<a href="http://www.dummies.com/how-to/content/how-to-create-a-word-2007-macro.html">ここ</a>、または<a href="http://oit.nd.edu/training/documentation/documents/macro_qrg.pdf">ここ</a>をクリックしてください。）</p>

<p>まだしていなければ、以下のように「開発」タブをリボンに追加します。Office ボタンをクリックします。「Word のオプション」をクリックします。「Word のオプション」ダイアログボックス内で「基本設定」をクリックします。「[開発]タブをリボンに表示する」をチェックし、OK をクリックします。Word を閉じます。</p>

<p>もう一度 Word を起動し、新しい Word ファイルを作成し、次の例のように、3行以上からなるサンプルテキストの段落を作成します。</p>

<p>これは段落です。これは段落です。これは段落です。これは段落です。これは段落です。これは段落です。これは段落です。これは段落です。これは段落です。これは段落です。これは段落です。これは段落です。これは段落です。これは段落です。これは段落です。これは段落です。これは段落です。これは段落です。これは段落です。これは段落です。これは段落です。これは段落です。</p>

<p>段落記号ボタンをクリックして、段落記号を表示します。</p>

<p>カーソルを段落の中（先頭行と末尾行以外）に置きます。</p>

<p>マクロの作成：</p>

<p>「開発」タブの中の「マクロの記録」をクリックします。</p>

<p>「マクロ名」ボックスの中に、「levelformat」のようなマクロの名称を入力します。すべての文書でマクロを使えるように、「マクロの保存先」ボックス内で「すべての文書（Normal.dotm）」を選びます。「Normal.dotm」を変更する場合、最初にバックアップをとっておいたほうがいいかもしれません。</p>

<p>「キーボード」ボタンをクリックします。「割り当てるキーを押してください」ボックス内をクリックして、割り当てられていないキーストロークを見つけてください。キーストロークが割り当て済みの場合は、そのことがダイアログ内に表示されるので、そのキーストロークを削除して別のキーストロークを試すことができます。Word を初期インストールした段階では、「Ctrl+Shift+9 」に機能は割り当てられていないようです。それ以外の割り当てられていないキーストロークを使うこともできます。</p>

<p>「割り当て」をクリックして、これから記録するマクロにショートカットキーを割り当てます。ここから先の操作はすべてマクロに記録されるので、以下の手順を注意深く実行してください。</p>

<p>Ctrl + 上矢印キー（カーソルが段落の先頭に移動します）</p>
<p>Ctrl + Shift + 下矢印キー（段落記号を含めて段落が選択されます。）</p>
<p>Shift + 左矢印キー（選択領域の末尾が 1 文字左へ移動し、段落記号が選択領域から外れます。）</p>
<p>Ctrl + C（段落をコピーします。）</p>
<p>Ctrl + V（段落のテキストが、元の場所に貼り付けられます。）</p>

<p>以上のコマンドを入力後に、「記録終了」をクリックします。</p>

<p>「マクロ」をクリックし、「levelformat」（またはマクロに与えた他の名称）を選択し、さらに「編集」を選択します。選んだマクロのコードが表示されます。「levelformat」のコードは次のようになります。</p>

<p>___________________<br/>Sub levelformat()<br/>'<br/>' levelformat macro<br/>'<br/>'<br/>Selection.MoveUp Unit:=wdParagraph, Count:=1<br/>Selection.MoveDown Unit:=wdParagraph, Count:=1, Extend:=wdExtend<br/>Selection.MoveLeft Unit:=wdWord, Count:=1, Extend:=wdExtend<br/>Selection.Copy<br/>Selection.PasteAndFormat (wdPasteDefault)<br/>End Sub<br/>___________________</p>

<p>次の行</p>
<p>    Selection.PasteAndFormat (wdPasteDefault)</p>
<p>を、以下のように変更します。</p>
<p>    Selection.PasteSpecial DataType:=wdPasteText</p>

<p>Ctrl+S によって保存し、マクロ編集ウィンドウを閉じます。</p>

<p>意図したとおりすべて動作すれば、マクロの導入に成功です。テストとして、1 単語を太字にするなど、Word 文書に何らかの書式を追加します。段落内の任意の場所にカーソルを置き、Ctrl+Shift+9（またはほかに選んだキーストローク）を押すと、設定した書式が消えるはずです。</p>

<p>ショートカットキーはいつでも変更できます。変更するには、Office ボタンをクリックし、開いたダイアログの右下にある「Word のオプション」をクリックします。</p>

<p>［ユーザー設定］→［コマンドの選択］をクリックします。ドロップダウンリストから［マクロ］を選びます。「levelformat」（またはほかに選んだ名称）を選択します。</p>

<p>ダイアログの下にある「ショートカットキー」の隣の「ユーザー設定」をクリックします。</p>

<p>「分類」ボックス内をスクロールして、「マクロ」を選択します。右側の「マクロ」ボックス内で、「levelformat」（またはほかに選んだ名称）を選択します。現在のショートカットキーが、「現在のキー」ボックス内に表示されます。そのキーを選んで、Delete を押します。次に、上述と同様に、新しいショートカットキーを入力し、「割り当て」をクリックしてキーを割り当てることができます。ダイアログを確認して閉じます。</p>

<p>同様の手順で、マクロ実行用のボタンを作成できます。</p>

<p>やはり Office ボタンをクリックし、さらに「Word のオプション」をクリックします。</p>

<p>［ユーザー設定］→［コマンドの選択］をクリックします。ドロップダウンリストから［マクロ］を選びます。マクロを選択します。</p>

<p>「追加」をクリックします。右側コラムにマクロコマンドが表示されるはずです。「変更」をクリックします。</p>

<p>使用するボタンイメージを選んで、「OK」→「OK」をクリックします。マクロのボタンイメージが、ツールバーに表示されるはずです。</p>

<p>このマクロは、視覚的な書式を含まない段落全体の書式を均一化するのに有用です。段落が望ましい書式を含んでいる場合は、段落を均一化した後に、削除した書式を復元する必要があります。多くの書式情報を含んでいる段落は、削除した書式を復元する作業が多くなるかもしれません。そのような段落については、次のような複数の代案があります。</p>

<ul> 

<li><p>Dave Turner の CodeZapper マクロを使用します。</p></li>

<li><p>段落全体ではなく、選択されたテキストのみを均一化するもう 1 つのマクロ（別のボタンとショートカットキー）を作成します。（上述の要領でマクロを記録しますが、Ctrl+V の後には Ctrl+C のみを記録します。）次に、書式が変わる 2 点間にあるテキストを選択します。これによって、同じ望ましい書式を持つ区間のテキストに関して書式が均一化され、削除された書式を復元する必要がなくなります。</p></li>

<li><p>この書式均一化マクロは、書式設定がまったくない、またはほとんどない段落に対してのみ使用してください。均一化しなかった段落にはわずらわしいタグが残りますが、それ以外ははるかにすっきりします。</p></li>

<li><p>上級ユーザーは、OmegaT のテキスト出力機能を使用したいと思うかもしれません。スクリプト te-st-notags を組み合わせて使えば、タグが表示されていない別のウィンドウが開きます。訳文を作成・編集する際に、タグを適切に処理する必要があることには変わりありませんが、タグが散らかっていない状態を別ウィンドウで見ることができます。</p></li>

</ul>

<p>Copyright Marc Prior 2009-2011</p>

</div>

